-- MySQL Script generated by MySQL Workbench
-- Fri Mar 25 21:33:17 2022
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema educdb_v2
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema educdb_v2
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `educdb_v2` DEFAULT CHARACTER SET utf8 ;
USE `educdb_v2` ;

-- -----------------------------------------------------
-- Table `educdb_v2`.`utilisateurs`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `educdb_v2`.`utilisateurs` ;

CREATE TABLE IF NOT EXISTS `educdb_v2`.`utilisateurs` (
  `idUtilisateur` INT NOT NULL AUTO_INCREMENT,
  `nom` VARCHAR(45) NOT NULL,
  `prenom` VARCHAR(45) NOT NULL,
  `statut` VARCHAR(45) NOT NULL DEFAULT 'attente',
  `groupe` VARCHAR(45) NULL DEFAULT NULL,
  `classe` VARCHAR(45) NULL DEFAULT NULL,
  `email` VARCHAR(45) NOT NULL,
  `motDePasse` VARCHAR(60) NOT NULL,
  PRIMARY KEY (`idUtilisateur`),
  UNIQUE (email))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `educdb_v2`.`cours`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `educdb_v2`.`cours` ;

CREATE TABLE IF NOT EXISTS `educdb_v2`.`cours` (
  `idCours` INT NOT NULL AUTO_INCREMENT,
  `responsable` INT NOT NULL,
  `nom` VARCHAR(45) NOT NULL,
  `dateCreation` DATE NULL,
  `code_acces` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`idCours`),
  CONSTRAINT `fk_utilisateurs_cours`
    FOREIGN KEY (`responsable`)
    REFERENCES `educdb_v2`.`utilisateurs` (`idUtilisateur`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `educdb_v2`.`acces-cours`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `educdb_v2`.`acces_cours` ;

CREATE TABLE IF NOT EXISTS `educdb_v2`.`acces_cours` (
  `idUtilisateur` INT NOT NULL,
  `idCours` INT NOT NULL,
  `accepte` TINYINT NOT NULL DEFAULT 0,
  `date_demande` DATE NULL DEFAULT NULL,

  PRIMARY KEY (`idUtilisateur`, `idCours`),
  CONSTRAINT `fk_utilisateurs_has_cours_utilisateurs1`
    FOREIGN KEY (`idUtilisateur`)
    REFERENCES `educdb_v2`.`utilisateurs` (`idUtilisateur`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_utilisateurs_has_cours_cours2`
    FOREIGN KEY (`idCours`)
    REFERENCES `educdb_v2`.`cours` (`idCours`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `educdb_v2`.`chapitre`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `educdb_v2`.`chapitre` ;

CREATE TABLE IF NOT EXISTS `educdb_v2`.`chapitre` (
  `idChapitre` INT NOT NULL AUTO_INCREMENT,
  `titreChapitre` VARCHAR(45) NOT NULL,
  `estVisible` TINYINT NOT NULL DEFAULT 0,
  `idCours` INT NOT NULL,
  PRIMARY KEY (`idChapitre`),
  CONSTRAINT `fk_cours_chapitres`
    FOREIGN KEY (`idCours`)
    REFERENCES `educdb_v2`.`cours` (`idCours`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `educdb_v2`.`quiz`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `educdb_v2`.`quiz` ;

CREATE TABLE IF NOT EXISTS `educdb_v2`.`quiz` (
  `idQuiz` INT NOT NULL AUTO_INCREMENT,
  `titre` VARCHAR(45) NOT NULL,
  `description` VARCHAR(300) NULL DEFAULT 'Pas de description',
  `estVisible` TINYINT NOT NULL DEFAULT 0,
  `idChapitre` INT NOT NULL,
  PRIMARY KEY (`idQuiz`),
  CONSTRAINT `fk_chapitre_quizs`
    FOREIGN KEY (`idChapitre`)
    REFERENCES `educdb_v2`.`chapitre` (`idChapitre`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `educdb_v2`.`questions`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `educdb_v2`.`questions` ;

CREATE TABLE IF NOT EXISTS `educdb_v2`.`questions` (
  `idQuestions` INT NOT NULL AUTO_INCREMENT,
  `titre` VARCHAR(45) NOT NULL,
  `enonce` VARCHAR(300) NULL DEFAULT "Pas d'Ã©nonce",
  `estQCM` TINYINT NOT NULL DEFAULT 0,
  `points` FLOAT NOT NULL DEFAULT 0,
  `img`  VARCHAR(300) DEFAULT "",
  `idQuiz` INT NOT NULL,
  PRIMARY KEY (`idQuestions`),
  CONSTRAINT `fk_quizs_questions`
    FOREIGN KEY (`idQuiz`)
    REFERENCES `educdb_v2`.`quiz` (`idQuiz`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;



-- -----------------------------------------------------
-- Table `educdb_v2`.`reponses`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `educdb_v2`.`reponses` ;

CREATE TABLE IF NOT EXISTS `educdb_v2`.`reponses` (
  `idReponse` INT NOT NULL AUTO_INCREMENT,
  `texteResponse` VARCHAR(300) NULL,
  `imgReponse` BLOB NULL,
  `estCorrecte` TINYINT NOT NULL DEFAULT 0,
  `idQuestions` INT NOT NULL,
  PRIMARY KEY (`idReponse`),
  CONSTRAINT `fk_questions_reponses`
    FOREIGN KEY (`idQuestions`)
    REFERENCES `educdb_v2`.`questions` (`idQuestions`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `educdb_v2`.`scores`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `educdb_v2`.`scores` ;

CREATE TABLE IF NOT EXISTS `educdb_v2`.`scores` (
  `idScores` INT NOT NULL,
  `idUtilisateurs` INT NOT NULL,
  `idQuizs` INT NOT NULL,
  `resultat` FLOAT NOT NULL DEFAULT 0,
  `total` FLOAT NOT NULL,
  `date_score` DATE NULL DEFAULT NULL,
  PRIMARY KEY (`idScores`, `idUtilisateurs`, `idQuizs`),
  CONSTRAINT `fk_utilisateurs_scores`
    FOREIGN KEY (`idUtilisateurs`)
    REFERENCES `educdb_v2`.`utilisateurs` (`idUtilisateur`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_quizs_scores`
    FOREIGN KEY (`idQuizs`)
    REFERENCES `educdb_v2`.`quiz` (`idQuiz`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

-- -----------------------------------------------------
-- Tout les index
-- -----------------------------------------------------
CREATE INDEX `fk_idUtilisateur_idx` ON `educdb_v2`.`cours` (`responsable` ASC) VISIBLE;
CREATE INDEX `fk_utilisateurs_has_cours_cours1_idx` ON `educdb_v2`.`acces_cours` (`idCours` ASC) VISIBLE;
CREATE INDEX `fk_utilisateurs_has_cours_utilisateurs_idx` ON `educdb_v2`.`acces_cours` (`idUtilisateur` ASC) VISIBLE;
CREATE INDEX `fk_idChapitre_idx` ON `educdb_v2`.`quiz` (`idChapitre` ASC) VISIBLE;
CREATE INDEX `fk_idQuizs_idx` ON `educdb_v2`.`questions` (`idQuiz` ASC) VISIBLE;
CREATE INDEX `fk_idQuestions_idx` ON `educdb_v2`.`reponses` (`idQuestions` ASC) VISIBLE;
CREATE INDEX `fk_idUtilisateurs_idx` ON `educdb_v2`.`scores` (`idUtilisateurs` ASC) VISIBLE;
CREATE INDEX `fk_idQuizs_score_idx` ON `educdb_v2`.`scores` (`idQuizs` ASC) VISIBLE;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
